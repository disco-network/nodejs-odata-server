{"version":3,"sources":["spec/integrationtest_query_spec.ts"],"names":[],"mappings":"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","file":"spec/integrationtest_query_spec.js","sourcesContent":["import odataQueryEngine = require(\"../src/adapter/query_engine\");\nimport sparqlProviderModule = require(\"../src/sparql/sparql_provider\");\nimport rdfstore = require(\"rdfstore\");\n\ndescribe(\"The query engine should evaluate\", () => {\n  function createQuerySpec(query: string, cb: (results: any) => void) {\n    it(query, (done) => {\n      rdfstore.create((error, store) => {\n        let graphName = \"http://example.org/\";\n        storeSeed(store, graphName, () => {\n          let sparqlProvider = new sparqlProviderModule.SparqlProvider(store, graphName);\n          let engine = new odataQueryEngine.QueryEngine();\n          engine.setSparqlProvider(sparqlProvider);\n          engine.query(query, results => {\n            cb(results);\n            done();\n          });\n        });\n      });\n    });\n  }\n\n  createQuerySpec(\"/Posts\", answer => {\n    let result = answer.result;\n    expectSuccess(answer);\n    expect(result.length).toBe(1);\n    expect(result[0].Id).toBe(\"1\");\n  });\n\n  createQuerySpec(\"/Posts?$expand=Content\", answer => {\n    let result = answer.result;\n    expectSuccess(answer);\n    expect(result).toEqual([\n      {\n        Id: \"1\",\n        ContentId: \"1\",\n        Content: {\n          Id: \"1\",\n          ContentId: \"1\",\n        },\n      },\n    ]);\n  });\n\n  createQuerySpec(\"/Posts?$expand=Content/Content\", answer => {\n    let result = answer.result;\n    expectSuccess(answer);\n    expect(result).toEqual([\n      {\n        Id: \"1\",\n        ContentId: \"1\",\n        Content: {\n          Id: \"1\",\n          ContentId: \"1\",\n          Content: {\n            Id: \"1\",\n            ContentId: \"1\",\n          },\n        },\n      },\n    ]);\n  });\n});\n\nfunction expectSuccess(answer) {\n  expect(answer.error).toBeUndefined();\n  expect(answer.result).toBeDefined();\n}\n\nfunction storeSeed(store, graphName, cb) {\n  store.rdf.setPrefix(\"rdf\", \"http://www.w3.org/1999/02/22-rdf-syntax-ns#\");\n  store.rdf.setPrefix(\"disco\", \"http://disco-network.org/resource/\");\n\n  let graph = store.rdf.createGraph();\n  graph.add(store.rdf.createTriple(\n    store.rdf.createNamedNode(store.rdf.resolve(\"disco:post1\")),\n    store.rdf.createNamedNode(store.rdf.resolve(\"rdf:type\")),\n    store.rdf.createNamedNode(store.rdf.resolve(\"disco:Post\"))\n  ));\n  graph.add(store.rdf.createTriple(\n    store.rdf.createNamedNode(store.rdf.resolve(\"disco:post1\")),\n    store.rdf.createNamedNode(store.rdf.resolve(\"disco:id\")),\n    store.rdf.createLiteral(\"1\")\n  ));\n  graph.add(store.rdf.createTriple(\n    store.rdf.createNamedNode(store.rdf.resolve(\"disco:post1\")),\n    store.rdf.createNamedNode(store.rdf.resolve(\"disco:content\")),\n    store.rdf.createNamedNode(store.rdf.resolve(\"disco:post1\"))\n  ));\n  graph.add(store.rdf.createTriple(\n    store.rdf.createNamedNode(store.rdf.resolve(\"disco:post1\")),\n    store.rdf.createNamedNode(store.rdf.resolve(\"disco:parent\")),\n    store.rdf.createLiteral(\"null\")\n  ));\n\n  store.insert(graph, graphName, cb);\n}"],"sourceRoot":"/source/"}