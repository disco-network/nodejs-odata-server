{"version":3,"sources":["src/odata/schema.ts"],"names":[],"mappings":"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","file":"src/odata/schema.js","sourcesContent":["/** @module */\n\nlet raw = {\n  entityTypes: {\n    Post: {\n      properties: {\n        Id: { autoIncrement_nextValue: 3, type: \"Edm.Int64\", rdfName: \"id\", nullable: \"auto-increment\" },\n        ContentId: { type: \"Edm.Int64\", mirroredFromNavigationProperty: \"Content\" },\n        ParentId: { type: \"Edm.Int64\", mirroredFromNavigationProperty: \"Parent\" },\n        Parent: { type: \"Post\", optional: true, quantity: \"one-to-many\",\n          mirroredIndexProperty: \"ParentId\", foreignSet: \"Posts\", foreignProperty: \"Children\",\n          rdfName: \"parent\", nullable: true },\n        Children: { type: \"Post\", quantity: \"many-to-one\", foreignSet: \"Posts\", foreignProperty: \"Parent\" },\n        Content: { type: \"Content\", quantity: \"one-to-many\", mirroredIndexProperty: \"ContentId\", rdfName: \"content\" },\n      },\n      rdfName: \"Post\",\n    },\n    Content: {\n      properties: {\n        Id: { type: \"Edm.Int64\", rdfName: \"id\" },\n        Title: { type: \"Edm.String\", rdfName: \"title\" },\n        Culture: { type: \"Culture\", quantity: \"one-to-many\", rdfName: \"culture\" },\n      },\n      rdfName: \"Content\",\n    },\n    Culture: {\n      properties: {\n        Id: { type: \"Edm.Int64\", rdfName: \"id\" },\n      },\n      rdfName: \"Culture\",\n    },\n  },\n  entitySets: {\n    Posts: {\n      type: \"Post\",\n    },\n    Content: {\n      type: \"Content\",\n    },\n  },\n  defaultNamespace: {\n    prefix: \"disco\",\n    uri: \"http://disco-network.org/resource/\",\n  },\n};\n\nexport class Schema {\n  public raw = raw;\n\n  public getEntitySet(name: string): EntitySet {\n    return new EntitySet(this, name);\n  }\n\n  public getEntityType(name: string): EntityType {\n    return new EntityType(this, name);\n  }\n}\n\nexport class EntitySet {\n  constructor(private completeSchema: Schema, private name: string) {\n    this.completeSchema = completeSchema;\n    this.name = name;\n  }\n\n  public getEntityType(): EntityType {\n    return this.completeSchema.getEntityType(this.getEntityTypeName());\n  }\n\n  public getEntityTypeName(): string {\n    return this.completeSchema.raw.entitySets[this.name].type;\n  }\n}\n\nexport class RdfBasedSchemaResource {\n  private rdfName: string;\n\n  constructor(protected completeSchema: Schema, private rawSchemaBranch, private name: string) {\n    this.rdfName = rawSchemaBranch && rawSchemaBranch.rdfName;\n  }\n\n  public getUri(): string {\n    return this.completeSchema.raw.defaultNamespace.uri + this.rdfName;\n  }\n\n  public getNamespacedUri(): string {\n    return this.completeSchema.raw.defaultNamespace.prefix + \":\" + this.rdfName;\n  }\n\n  public getName(): string {\n    return this.name;\n  }\n\n  public getRaw() {\n    return this.rawSchemaBranch;\n  }\n\n  public hasDirectRdfRepresentation(): boolean {\n    return this.rdfName != null;\n  }\n}\n\nexport class EntityType extends RdfBasedSchemaResource {\n  constructor(completeSchema: Schema, name: string) {\n    super(completeSchema, completeSchema.raw.entityTypes[name], name);\n  }\n\n  public getUri(): string {\n    if (this.isElementary())\n      throw new Error(\"elementary types don\\'t have a URI representation [\" + this.getName() + \"]\");\n    return super.getUri();\n  }\n\n  public getNamespacedUri(): string {\n    if (this.isElementary())\n      throw new Error(\"elementary types don\\'t have a URI representation [\" + this.getName() + \"]\");\n    return super.getUri();\n  }\n\n  public isElementary(): boolean {\n    return this.getName().substr(0, 4) === \"Edm.\";\n  }\n\n  public getProperty(name: string): Property {\n    return new Property(this.completeSchema, this, name);\n  }\n\n  public getPropertyNames(): string[] {\n    if (this.isElementary()) throw new Error(\"elementary types don\\'t have properties [\" + this.getName() + \"]\");\n    return Object.keys(this.getRaw().properties);\n  }\n}\n\nexport class Property extends RdfBasedSchemaResource {\n  constructor(completeSchema: Schema, private parentType: EntityType, name: string) {\n    super(completeSchema, parentType.getRaw().properties[name], name);\n  }\n\n  public getEntityType(): EntityType {\n    return this.completeSchema.getEntityType(this.getRaw().type);\n  }\n\n  public isNavigationProperty(): boolean {\n    return this.getEntityType().isElementary() === false;\n  }\n\n  public isQuantityOne(): boolean {\n    return !this.isNavigationProperty() || this.getRaw().quantity.substr(0, 4) === \"one-\";\n  }\n\n  public isOptional(): boolean {\n    return this.getRaw().optional === true;\n  }\n\n  public hasInverseProperty(): boolean {\n    return this.getRaw().foreignProperty != null;\n  }\n\n  public getInverseProperty(): Property {\n    let setName = this.getRaw().foreignSet;\n    let propName = this.getRaw().foreignProperty;\n    return this.completeSchema.getEntitySet(setName).getEntityType().getProperty(propName);\n  }\n\n  public mirroredFromProperty(): Property {\n    let name = this.getRaw().mirroredFromNavigationProperty;\n    return name && new Property(this.completeSchema, this.parentType, this.getRaw().mirroredFromNavigationProperty);\n  }\n}\n"],"sourceRoot":"/source/"}